<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <!-- <li>Filter for a city</li>
      <li>or a state</li> -->
    </ul>
  </form>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js" integrity="sha512-xIPqqrfvUAc/Cspuj7Bq0UtHNo/5qkdyngx6Vwt+tmbvTLDszzXM0G6c91LXmGrRx8KEPulT+AfOOez+TeVylg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';


const cities = [];

// axios.get(endpoint)
//   .then(res=>{
//     const data = res.data
//     console.log(data)
//   })

// fetch()api å›å‚³promiseï¼Œéœ€è¦ç”¨.then()æ¥ä½è³‡æ–™
fetch(endpoint,{
})
// blog.json()æœƒè¿”å›å¦ä¸€å€‹promiseï¼Œè¦ç”¨thenå†å»æ¥è¦å¾—åˆ°çš„æ•¸å€¼
  .then(blog => blog.json())
  // get each item to go into cities
  // ...dataè¡¨ç¤ºå°‡dataè³‡æ–™
  .then(data => cities.push(...data))

// match() æ–¹æ³•å¯ä»¥åœ¨å­—ä¸²å…§æª¢ç´¢æŒ‡å®šçš„å€¼ï¼Œå›å‚³ç¬¦åˆçš„å­—ä¸²ï¼Œå¦å‰‡å›å‚³null
// é¡ä¼¼indexOf()ï¼Œä¸ématch()æ˜¯è¿”å›ç¬¦åˆçš„å­—ä¸²ï¼Œè€ŒindexOf()æ˜¯è¿”å›è©²å­—ä¸²çš„ç´¢å¼•å€¼
// å¯ä»¥æ­é…æ­£è¦è¡¨é”å¼ä½¿ç”¨
function findMatches(wordToMatch, cities) {
  return cities.filter(place => {
    //figure out if the city or state matches what was searched
    // æ­£è¦è¡¨é”å¼ä¸­giä»£è¡¨å…¨æ–‡æŸ¥æ‰¾å‡ºç¾çš„æ‰€æœ‰åŒ¹é…å­—ä¸²(g)ï¼Œå¿½ç•¥å¤§å°å¯«(i)
    const regex = new RegExp(wordToMatch, 'gi');
    return place.city.match(regex) || place.state.match(regex)
  })
}
function numberWithCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',')
}

function displayMatches(){
  const matchArray = findMatches(this.value, cities)
  // å°‡æœ‰ç¬¦åˆçš„é™£åˆ—ï¼Œå›å‚³ç‚ºhtmlçš„å­—ä¸²
  const html = matchArray.map(place => {
    // æœå°‹åˆ°çš„å­—è©è¦é¡¯ç¤ºé¡è‰²
    const regex = new RegExp(this.value, 'gi')
    // æ›¿æ›æˆæœ‰hlçš„class
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`)
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`)
    return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>
        <span class="population">${numberWithCommas(place.population)}</span>
      </li>
    `
  }).sort().join(''); //å¯ä»¥å°‡è¿”å›çš„arrayï¼Œè®Šæˆä¸€å€‹å¤§å­—ä¸²
  // console.log(html)
  // é¡¯ç¤ºåœ¨ç•«é¢ä¸Š
  suggestions.innerHTML = html
}



const searchInput = document.querySelector('.search')
const suggestions = document.querySelector('.suggestions')

// ç•¶inputçš„æ•¸å€¼æœ‰æ”¹è®Šæ™‚ï¼Œå‘¼å«displayMatches()
// changeåªæœƒåœ¨æ²’ä½¿ç”¨inputæ™‚ï¼Œæ‰æœƒç™¼å‹•ã€‚å¦‚æœè¦æ¯æ¬¡è¼¸å…¥éƒ½è¦ç›£è½ï¼Œå¯ä»¥ä½¿ç”¨keyup
searchInput.addEventListener('change', displayMatches)
searchInput.addEventListener('keyup', displayMatches)

</script>
</body>
</html>
